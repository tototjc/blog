---
import type { InferGetStaticPropsType, InferGetStaticParamsType, GetStaticPaths } from 'astro'

import config from 'virtual:config'

import { posts, groups } from '@/utils/getContents'

import PostsLayout from '@/layouts/Posts.astro'

type Params = InferGetStaticParamsType<typeof getStaticPaths>
type Props = InferGetStaticPropsType<typeof getStaticPaths>

export const getStaticPaths = (({ paginate }) => [
  ...paginate(posts, { pageSize: config.postlist.pageSize }),
  ...groups.flatMap(({ path: groupPath, group }) =>
    group.flatMap(({ path: collectionPath, collection }) =>
      paginate(collection, {
        params: { path: `${groupPath}/${collectionPath}` },
        pageSize: config.postlist.pageSize,
      }),
    ),
  ),
]) satisfies GetStaticPaths

const { path } = Astro.params as Params
const { page } = Astro.props
---

<PostsLayout path={path} page={page} />
